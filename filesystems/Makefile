# Set the path to the Kernel build utils.
KBUILD=/lib/modules/$(shell uname -r)/build/

Kbuild: 
	echo "# autogenerated, do not edit " > $@
	echo "ccflags-y += -Wno-unused-function -Wno-unused-label -Wno-unused-variable " >> $@
	
	for i in $(shell cd . && find -mindepth 1 -name Kbuild | xargs --no-run-if-empty dirname); do echo "obj-m += $$i/" >> $@; done


build: $(KCONFIG) Kbuild
	$(MAKE) -C $(KBUILD) M=$(PWD) modules
	for i in $(shell find . -name Makefile | xargs --no-run-if-empty dirname); do $(MAKE) -C $$i; done

clean:
	$(MAKE) -C $(KBUILD) M=$(PWD) clean
	rm $(PWD)/minfs/user/mkfs.minfs -v

menuconfig:
	$(MAKE) -C $(KBUILD) M=$(PWD) menuconfig

.PHONY: build clean
